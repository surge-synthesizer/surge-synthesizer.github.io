on:
  repository_dispatch:
    types: [surge-build-nightly]

jobs:
  commit-payload:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5

      - env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          jq . <<< '${{ toJson(github.event.client_payload) }}' > src/content/generated/surge-build-nightly.json
          git config user.name github-actions[bot]
          git config user.email 41898282+github-actions[bot]@users.noreply.github.com
          git add -A
          git commit -m 'github-actions: Update surge-build-nightly.json from dispatch event' || echo "No changes to commit"
          git push origin master

  build:
    needs: commit-payload
    uses: ./.github/workflows/build.yaml
